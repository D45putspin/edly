<html>

<head>
    <script src="http://code.jquery.com/jquery-1.6.2.min.js"></script>
    <meta charset="utf-8">

</head>
<a>Bem vindo </a><a id="username">USER</a>
<input type="button" id="logout" value="logout">


<section id="condutor">
    <h1> condutor!!!</h1>
</section>
<section id="cliente">
    <h1> cliente!!!</h1>
</section>
<section id="administrador">
    <h1> administrador!!!</h1>
</section>
<section id="empresa">
    <h1>empresa!!!</h1>

</section>
<script>

    function verificarloja(token) {
       var json=decode(token);
       var id = json.id_user;
       getlojas(id);

    }
    function getlojas(id){
        var ident=id;
        var new_data={"id":ident};
        var dataJson = JSON.stringify(new_data);
        $.ajax({
                url: 'http://localhost:3000/loja/verificar_lojas',
                type: 'POST',
                cache: false,
                dataType: 'Json',
                contentType: 'application/json',

                data:  dataJson ,
                success: function (data) {
                  window.alert(data.message)

                }
                , error: function (jqXHR, textStatus, err) {
                   
                    console.log(err,textStatus)
                }
            })
    }



    //LOGOUT/**//**//**//**//**//**//**//**//**//**//**//**//**//**/
    $('#logout').click(function () {
        document.cookie = "token=; expires=Thu, 01 Jan 1970 00:00:00 UTC";
    });
    var x = document.cookie;


    function decode(token) {
        var base64Url = x.split('.')[1];
        var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
        var jsonPayload = decodeURIComponent(atob(base64).split('').map(function (c) {
            return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
        }).join(''));
        let json = JSON.parse(jsonPayload);
        return json;
    }

    let json = decode(x);
    let tipo = json.tipo
    let nome=json.nome;
    console.log("tipo->" + tipo)
    CheckProfile(tipo);



    /*greeting /**//**//**//**//**//**//**//**//**//**//**//**/
    /**/document.getElementById("username").innerHTML = nome;
    /**//**//**//**//**//**//**//**//**//**//**//**//**//**//**/

    /**//**//**//**//**//**//**//**//**//**//**//**//**//**//**/
    function CheckProfile(tipo) {
        switch (tipo) {
            case "condutor":

                document.getElementById("cliente").style.display = "none";
                document.getElementById("administrador").style.display = "none";
                document.getElementById("empresa").style.display = "none";
                break;
            case "cliente":

                document.getElementById("condutor").style.display = "none";
                document.getElementById("administrador").style.display = "none";
                document.getElementById("empresa").style.display = "none";
                break;
            case "administrador":

                document.getElementById("cliente").style.display = "none";
                document.getElementById("condutor").style.display = "none";
                document.getElementById("empresa").style.display = "none";
                break;
            case "empresa":

                document.getElementById("cliente").style.display = "none";
                document.getElementById("administrador").style.display = "none";
                document.getElementById("condutor").style.display = "none";
                verificarloja(x);
                break;
        }

    }


    /*function to verify if cookie is set /**//**//**//**/
    setInterval(function () {
        var x = document.cookie;
        if (x == "") {
            console.log("sem cookie")
            window.location.href = "../edly/login.html";

        } else {


        }

    }, 1000);


</script>

</html>