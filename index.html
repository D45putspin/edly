<html>

<head>


    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="http://code.jquery.com/jquery-1.6.2.min.js"></script>
    <meta charset="UTF-8">
    <title>EDLY</title>
    <link rel="stylesheet" href="index.css">
    <script type="text/javascript" src="materialize.min.js"></script>
    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

</head>

<header>
    <!-- Navegation bar-->
    <nav class="nav-extended">
        <div class="navlr">
            <!-- Nome do user e botao logout-->
            <ul>
                <li><a class="lr waves-effect waves-light btn-small #fafafa grey lighten-5" style="color:black;"
                        id="username" href="#"></a></li>
                <li> <a class="lr" type="button" id="logout" value="logout">logout</a></li>
            </ul>
            <!-- Navegation bar para clientes-->
            <div id="navcliente2">
                <ul>
                    <div class="typeln">
                        <span class="material-icons">
                            person
                        </span>
                        <h4>Cliente</h4>
                    </div>
                </ul>
            </div>
            <!-- Navegation bar para condutores-->
            <div id="navcondutor2">
                <ul>
                    <div class="typeln">
                        <span class="material-icons">
                            moped
                        </span>
                        <h4>Condutor</h4>
                    </div>
                </ul>
            </div>
            <!-- Navegation bar para empresas-->
            <div id="navempresa2">
                <ul>
                    <div class="typeln">
                        <span class="material-icons">
                            business
                        </span>
                        <h4>Empresa</h4>
                    </div>
                </ul>
            </div>
            <!-- Navegation bar para admin-->
            <div id="navadministrador2">
                <ul>
                    <div class="typeln">
                        <span class="material-icons">
                            supervisor_account
                        </span>
                        <h4>Administrador</h4>
                    </div>
                </ul>
            </div>
        </div>
        <div class="nav-wrapper">
            <a href="index.html">
                <img class="responsive-img" src="imagens/logo.png">
            </a>
        </div>

        <!-- Navegation bar para clientes-->
        <div id="navcliente">
            <div class="nav-content">
                <ul class="tabs tabs-transparent">
                    <li class="tab"><a class="active" href="#encontrar">Encontrar</a></li>
                    <li class="tab"><a href="#editarcliente">Editar dados</a></li>
                    <li class="tab"><a href="#contactecliente">Contacte-nos</a></li>
                </ul>
            </div>
        </div>
        <!-- Navegation bar para condutores-->
        <div id="navcondutor">
            <div class="nav-content">
                <ul class="tabs tabs-transparent">
                    <li class="tab"><a class="active" href="#encomendas">Encomendas</a></li>
                    <li class="tab"><a href="#editarcondutor">Editar dados</a></li>
                    <li class="tab"><a href="#contactecondutor">Contacte-nos</a></li>
                </ul>
            </div>
        </div>
        <!-- Navegation bar para empresas-->
        <div id="navempresa">
            <div class="nav-content">
                <ul class="tabs tabs-transparent">
                    <li class="tab"><a class="active" href="#lojas">Lojas</a></li>
                    <li class="tab"><a href="#editarempresa">Editar dados</a></li>
                    <li class="tab"><a href="#contacteempresa">Contacte-nos</a></li>
                </ul>
            </div>
        </div>
        <!-- Navegation bar para admin-->
        <div id="navadministrador">
            <div class="nav-content">
                <ul class="tabs tabs-transparent">
                    <li class="tab"><a class="active" href="#pedidos">Pedidos</a></li>
                    <li class="tab"><a href="#editaradmin">Editar dados</a></li>
                    <li class="tab"><a href="#contacteadmin">Contacte-nos</a></li>
                </ul>
            </div>
        </div>

    </nav>
</header>


<!-- Pagina do condutor-->

<section id="condutor">

    <!-- Pagina das encomendas-->
    <div id="encomendas">
        <h1>encomendas</h1>
    </div>
    <!-- Pagina de editar condutor-->
    <div id="editarcondutor">
        <h2>Editar dados</h2>
        <div class="row" style="margin-left: 10%; margin-right: auto;">
            <form class="col s12">
                <div id="esquerda">
                    <h6>Nome</h6>
                    <div class="row">
                        <div class="input-field col s6">
                            <input id="nome" type="text" class="validate">
                        </div>
                    </div>
                    <h6>Email</h6>
                    <div class="row">
                        <div class="input-field col s6">
                            <input id="email" type="email" class="validate">
                        </div>
                    </div>
                    <h6>Codigo-Postal</h6>
                    <div class="row">
                        <div class="input-field col s6">
                            <input id="codigopostal" type="text" class="validate" pattern="[0-9]{4}[-]{1}[0-9]{3}"
                                title="Coloque o formato correto XXXX-XXX" placeholder="XXXX-XXX">
                        </div>
                    </div>
                    <h6>Morada</h6>
                    <div class="row">
                        <div class="input-field col s6">
                            <input id="morada" type="text" class="validate">
                        </div>
                    </div>
                    <h6>Tipo de veiculo</h6>
                    <div class="row">
                        <div class="input-field col s6">
                            <input id="tipo_veiculo" type="text" class="validate">
                        </div>
                    </div>
                </div>
                <div id="direita">
                    <h6>NIF</h6>
                    <div class="row">
                        <div class="input-field col s6">
                            <input id="nif" type="text" class="validate" pattern="[1,2,5]{1}[0-9]{8}"
                                title="Insira um NIF valido.">
                        </div>
                    </div>

                    <h6>Cidade</h6>
                    <div class="row">
                        <div class="input-field col s6">
                            <input id="cidade" type="text" class="validate">
                        </div>
                    </div>

                    <h6>Matricula</h6>
                    <div class="row">
                        <div class="input-field col s6">
                            <input id="matricula type=" text" class="validate">
                        </div>
                    </div>

                    <h6>Palavra-passe</h6>
                    <div class="row">
                        <div class="input-field col s6">
                            <input id="password" type="password" class="validate" oninput="setpasswd()">
                            <p class="message" id="message"></p>
                        </div>
                    </div>
                </div>
                <div id="botoes">
                    <button class="waves-effect waves-light btn-small #212121 grey darken-4"
                        id="confirmarcondutor">Confirmar</button>
                    <button class="waves-effect waves-light btn-small #212121 orange darken-1"
                        id="editarpasswordcondutor">Alterar palavra-passe</button>
                    <button class="waves-effect waves-light btn-small red darken-4" id="eliminarcondutor">Eliminar
                        conta</button>
                </div>
        </div>
        </form>
    </div>

    </div>
    <!-- Pagina de contacte-->
    <div id="contactecondutor">

    </div>

</section>

<!-- Pagina do cliente-->

<section id="cliente">
    <!-- Pagina do encontrar-->
    <div id="encontrar">
        <h1>Recomendado</h1>
        <div class="row" id="encontrartoplojas">
        </div>
        <h2> Mais Lojas</h2>
        <div class="row" id="encontrarAllLojas">
        </div>
        <div class="row" id="rowprodutos_cliente">
        </div>
    </div>

    <!-- Pagina de editar cliente-->
    <div id="editarcliente">
        <h2>Editar dados</h2>
        <div class="row" style="margin-left: 10%; margin-right: auto;">
            <form class="col s12">
                <div id="esquerda">
                    <h6>Nome</h6>
                    <div class="row">
                        <div class="input-field col s6">
                            <input id="nome" type="text" class="validate">
                        </div>
                    </div>
                    <h6>Email</h6>
                    <div class="row">
                        <div class="input-field col s6">
                            <input id="email" type="email" class="validate">
                        </div>
                    </div>
                    <h6>Codigo-Postal</h6>
                    <div class="row">
                        <div class="input-field col s6">
                            <input id="codigopostal" type="text" class="validate" pattern="[0-9]{4}[-]{1}[0-9]{3}"
                                title="Coloque o formato correto XXXX-XXX" placeholder="XXXX-XXX">
                        </div>
                    </div>
                    <h6>Morada</h6>
                    <div class="row">
                        <div class="input-field col s6">
                            <input id="morada" type="text" class="validate">
                        </div>
                    </div>
                </div>
                <div id="direita">
                    <h6>NIF</h6>
                    <div class="row">
                        <div class="input-field col s6">
                            <input id="nif" type="text" class="validate" pattern="[1,2,5]{1}[0-9]{8}"
                                title="Insira um NIF valido.">
                        </div>
                    </div>

                    <h6>Cidade</h6>
                    <div class="row">
                        <div class="input-field col s6">
                            <input id="cidade" type="text" class="validate">
                        </div>
                    </div>

                    <h6>Palavra-passe</h6>
                    <div class="row">
                        <div class="input-field col s6">
                            <input id="password" type="password" class="validate" oninput="setpasswd()">
                            <p class="message" id="message"></p>
                        </div>
                    </div>
                </div>
                <div id="botoes">
                    <button class="waves-effect waves-light btn-small #212121 grey darken-4"
                        id="editarcliente">Confirmar</button>
                    <button class="waves-effect waves-light btn-small #212121 orange darken-1"
                        id="editarpasswordcliente">Alterar palavra-passe</button>
                    <button class="waves-effect waves-light btn-small red darken-4" id="eliminarcliente">Eliminar
                        conta</button>
                </div>
            </form>
        </div>

    </div>
    <!-- Pagina de contacte-->
    <div id="contactecliente">
    </div>
</section>


<!-- Currently working section  start date- 30/12/2020 
    what to do: -panel to deny or accept enterprises/workers account creation.
                -create another admin accounts
                -delete  already acepted enterprises
                




-->

<!-- Pagina do administradores-->

<section id="administrador">
    <!-- Pagina dos pedidos-->
    <div id="pedidos">
        <h1> pedidos pendentes </h1>
        <div class="row " id="rowpedidospend">
        </div>
    </div>
    <!-- Pagina de editar admin-->
    <div id="editaradmin">
        <h2>Editar dados</h2>
        <div class="row" style="margin-left: 10%; margin-right: auto;">
            <form class="col s12">
                <div id="esquerda">
                    <h6>Nome</h6>
                    <div class="row">
                        <div class="input-field col s6">
                            <input id="nome" type="text" class="validate">
                        </div>
                    </div>
                    <h6>Email</h6>
                    <div class="row">
                        <div class="input-field col s6">
                            <input id="email" type="email" class="validate">
                        </div>
                    </div>
                    <h6>Codigo-Postal</h6>
                    <div class="row">
                        <div class="input-field col s6">
                            <input id="codigopostal" type="text" class="validate" pattern="[0-9]{4}[-]{1}[0-9]{3}"
                                title="Coloque o formato correto XXXX-XXX" placeholder="XXXX-XXX">
                        </div>
                    </div>
                    <h6>Morada</h6>
                    <div class="row">
                        <div class="input-field col s6">
                            <input id="morada" type="text" class="validate">
                        </div>

                    </div>
                </div>
                <div id="direita">
                    <h6>NIF</h6>
                    <div class="row">
                        <div class="input-field col s6">
                            <input id="nif" type="text" class="validate" pattern="[1,2,5]{1}[0-9]{8}"
                                title="Insira um NIF valido.">
                        </div>
                    </div>

                    <h6>Cidade</h6>
                    <div class="row">
                        <div class="input-field col s6">
                            <input id="cidade" type="text" class="validate">
                        </div>
                    </div>

                    <h6>Palavra-passe</h6>
                    <div class="row">
                        <div class="input-field col s6">
                            <input id="password" type="password" class="validate" oninput="setpasswd()">
                            <p class="message" id="message"></p>
                        </div>
                    </div>
                </div>
                <div id="botoes">
                    <button class="waves-effect waves-light btn-small #212121 grey darken-4"
                        id="editaradmin">Confirmar</button>
                    <button class="waves-effect waves-light btn-small #212121 orange darken-1"
                        id="editarpasswordadmin">Alterar palavra-passe</button>
                    <button class="waves-effect waves-light btn-small red darken-4" id="eliminaradmin">Eliminar
                        conta</button>
                </div>
        </div>
        </form>
    </div>
    </div>
    <!-- Pagina de contacte-->
    <div id="contacteadmin">

    </div>

    </div>

</section>

















<!-- almost done !!!!! 30/12/2020 
    empresas - enterprises
    can add lojas - stores 
    stores can add produtos-products


    falta imagem da store e da empresa se for necessário
    produtos ja com foto a funcionar, codigo em : linha 10/19 produtos.js; 


-->

<!-- Pagina da empresas-->

<section id="empresa">

    <!-- Pagina de lojas-->

    <div id="lojas">

        <a href="#" id="myBtn" class="float " data-toggle="tooltip" title="adicionar lojas">
            <span class="material-icons">
                add
            </span>
            <i class="fa fa-plus my-float"> </i>
        </a>

        <div id="myModal" class="modal">

            <!-- Criar loja -->
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Nova Loja</h2>
                    <span class="close">&times;</span>

                </div>
                <div class="row">
                    <form class="col s12">
                        <div class="row">
                            <div class="input-field col s12">
                                <div class="esquerda">
                                    <input type="text" placeholder="Nome" id="nome_empresa" name="nome_empresa"
                                        class="validate">
                                    <input type="text" placeholder="Tipo de Comida" id="tipo_empresa"
                                        name="tipo_empresa" class="validate">
                                    <input class="lr waves-effect waves-light btn-small #fafafa grey lighten-5"
                                        style=" float: left;" type="button" id="enter_empresa" value="enter">
                                </div>
                                <div class="direita">
                                    <input type="text" placeholder="Morada" id="morada_empresa" name="morada_empresa"
                                        class="validate">
                                    <input type="text" pattern="[0-9]{4}[-]{1}[0-9]{3}"
                                        title="Coloque o formato correto XXXX-XXX"
                                        placeholder="Código postal (XXXX-XXX)" id="cp_empresa" name="cp_empresa"
                                        class="validate">
                                </div>
                            </div>
                        </div>
                    </form>
                </div>

            </div>

        </div>
        <div id="myModal1" class="modal">

            <!-- Criar produto -->
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Adicionar Produtos</h2>
                    <span class="close1">&times;</span>

                </div>
                <div class="row">
                    <form class="col s12">
                        <div class="row">
                            <div class="input-field col s12">
                                <div class="esquerda">
                                    <input type="text" placeholder="Nome Produto" id="nome_produto" name="nome_produto"
                                        class="validate">
                                    <input type="text" placeholder="Preço" id="preco_produto" name="preco_produto"
                                        class="validate">
                                    <div class="fotop">
                                        <form action="#">
                                            <div class="file-field input-field">
                                                <div
                                                    class="lr waves-effect waves-light btn-small #fafafa grey lighten-5">
                                                    <span>Foto</span>
                                                    <input type="file" id="foto_produto" name="foto_produto"
                                                        accept="image/png, image/jpeg">
                                                </div>
                                                <div class="file-path-wrapper">
                                                    <input class="file-path validate" type="text"
                                                        placeholder="Upload one or more files">
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                    <input class="lr waves-effect waves-light btn-small #fafafa grey lighten-5"
                                        style=" float: left;" type="button" id="enter_empresa1" value="enter">
                                </div>
                                <div class="direita">
                                    <input type="text" placeholder="Descrição do produto" id="descricao_produto"
                                        name="descricao_produto" class="validate">
                                </div>
                            </div>
                        </div>
                    </form>
                </div>

            </div>

        </div>
        <ul id="ullojas">
            <div id="DispNrLojas">
                <span class="material-icons">
                    store
                </span>
                <h1 id="numerodeloja"> 0 </h1>
            </div>
            <div class="row " id="row">

            </div>
        </ul>
        <ul id="produtos" style="position: relative; top: -150px;">
            <div id="namelojaprodutos">

            </div>
            <div class="row " id="rowprodutos">

            </div>
        </ul>
    </div>

    <!-- Pagina de editar empresas-->

    <div id="editarempresa">
        <h2>Editar dados</h2>
        <div class="row" style="margin-left: 10%; margin-right: auto;">
            <form class="col s12">
                <div id="esquerda">
                    <div class="row">
                        <div class="input-field col s6">
                            <h6>Nome</h6>
                            <input id="nome" type="text" class="validate">
                        </div>
                    </div>

                    <div class="row">
                        <div class="input-field col s6">
                            <h6>Email</h6>
                            <input id="email" type="email" class="validate">
                        </div>
                    </div>
                    <div class="row">
                        <div class="input-field col s6">
                            <h6>Codigo-Postal</h6>
                            <input id="codigopostal" type="text" class="validate" pattern="[0-9]{4}[-]{1}[0-9]{3}"
                                title="Coloque o formato correto XXXX-XXX" placeholder="XXXX-XXX">
                        </div>
                    </div>
                    <div class="row">
                        <div class="input-field col s6">
                            <h6>Morada</h6>
                            <input id="morada" type="text" class="validate">
                        </div>
                    </div>
                </div>
                <div id="direita">
                    <div class="row">
                        <div class="input-field col s6">
                            <h6>NIF</h6>
                            <input id="nif" type="text" class="validate" pattern="[1,2,5]{1}[0-9]{8}"
                                title="Insira um NIF valido.">
                        </div>
                    </div>

                    <div class="row">
                        <div class="input-field col s6">
                            <h6>Cidade</h6>
                            <input id="cidade" type="text" class="validate">
                        </div>
                    </div>

                    <div class="row">
                        <div class="input-field col s6">
                            <h6>Palavra-passe</h6>
                            <input id="password" type="password" class="validate" oninput="setpasswd()">
                            <p class="message" id="message"></p>
                        </div>
                    </div>

                    <div class="file-field input-field col s6">
                        <div class="waves-effect waves-light btn-small #212121 grey darken-4">
                            <span>Foto</span>
                            <input type="file" name="img_empresa" id="img_empresa">
                        </div>
                        <div class="file-path-wrapper">
                            <input class="file-path validate" type="text" placeholder="escolha uma foto ">
                        </div>
                    </div>
                </div>
                <br>
                <div id="botoes">
                    <button class="waves-effect waves-light btn-small #212121 grey darken-4"
                        id="confirmarempresa">Confirmar</button>
                    <button class="waves-effect waves-light btn-small #212121 orange darken-1"
                        id="editarpasswordempresa">Alterar palavra-passe</button>
                    <button class="waves-effect waves-light btn-small red darken-4" id="eliminarempresa">Eliminar
                        conta</button>
                </div>
            </form>
        </div>

    </div>

    <!-- Pagina de contacte-->

    <div id="contacteempresa">

    </div>

</section>
<script>
    const urlattime = "localhost:3000";
    let params = (new URL(document.location)).searchParams;
    let loja = params.get("loja");

    $('#enter_empresa1').click(function () {
        var token = document.cookie;
        var tokenrl = token.replace("token=", "");
        let tokendecode = decode(tokenrl);
        var nome_prod = document.getElementById('nome_produto').value;
        var preco_prod = document.getElementById('preco_produto').value;
        var descricao_produto = document.getElementById('descricao_produto').value;
        //appends image (and the other data) to fd so you can send it on data to database 
        var fd = new FormData();
        var file = $('#foto_produto')[0].files[0];
        fd.append('produto_imagem', file);
        fd.append('nome_produto', nome_prod);
        fd.append('tipo', descricao_produto);
        fd.append('id', loja);
        fd.append('id_empresa', tokendecode.id_user);
        fd.append('preco', preco_prod);

        if (nome_prod && descricao_produto && preco_prod) {

            if (preco_prod > 0) {
                $.ajax({
                    url: 'http://' + urlattime + '/produtos/criar-produtos',
                    type: 'POST',
                    cache: false,
                    data: fd,
                    headers: { "token": tokenrl },
                    contentType: false,
                    processData: false,
                    success: function (data) {
                        console.log(data);
                        M.toast({ html: 'Produto criado com sucesso!', classes: 'rounded' })


                    }
                    , error: function (jqXHR, textStatus, err) {
                        console.log(err, textStatus);
                        M.toast({ html: 'Erro ao criar o produto!', classes: 'rounded' })
                    }
                })
            } else {
                M.toast({ html: 'Coloque um formato de preço correto', classes: 'rounded' })
            }
        } else {
            M.toast({ html: 'Campos vazios!', classes: 'rounded' })
        }








    })

    $('#enter_empresa').click(function () {
        let nome = nome_empresa.value;
        let tipo = tipo_empresa.value;
        let morada = morada_empresa.value;
        let cod_postal = cp_empresa.value;
        var token = document.cookie;
        var tokenrl = token.replace("token=", "");
        let tokendecode = decode(tokenrl);
        let id = tokendecode.id_user;

        if (nome && tipo && morada && cod_postal) {

            $.ajax({
                url: 'http://' + urlattime + '/loja/inserir_lojas',
                type: 'POST',
                cache: false,
                data: { nome: nome, tipo: tipo, morada: morada, token: tokenrl, id: id, cod_postal: cod_postal },
                headers: { "token": tokenrl },
                success: function (data) {
                    window.location.href = "?sucesso=y";
                    M.toast({ html: 'Loja criada com sucesso', classes: 'rounded' })

                }
                , error: function (jqXHR, textStatus, err) {
                    M.toast({ html: 'Erro ao criar a loja!', classes: 'rounded' })
                    console.log(err, textStatus);
                }
            })
        } else {
            M.toast({ html: 'Campos vazios', classes: 'rounded' })
        }
    });


    if (loja == null) {
//modal adicionar lojas/**//**//**//**//**//**//**//**//**//**//**//**//**//**//**//**//**//**//**//**//**/
/**/// Get the modal
/**/var modal = document.getElementById("myModal");
/**/
/**/// Get the button that opens the modal
/**/var btn = document.getElementById("myBtn");
/**/
/**/// Get the <span> element that closes the modal
/**/var span = document.getElementsByClassName("close")[0];
/**/
/**/// When the user clicks the button, open the modal 
/**/btn.onclick = function () {
/**/  modal.style.display = "block";
            /**/
        }
/**/
/**/// When the user clicks on <span> (x), close the modal
/**/span.onclick = function () {
/**/  modal.style.display = "none";
            /**/
        }
/**/
/**/// When the user clicks anywhere outside of the modal, close it
/**/window.onclick = function (event) {
/**/  if (event.target == modal) {
/**/    modal.style.display = "none";
                /**/
            }
            /**/
        }
        /**//**//**//**//**//**//**//**//**//**//**//**//**//**//**//**//**//**//**//**/
    }
    else {
//modal editar lojas/**//**//**//**//**//**//**//**//**//**//**//**//**//**//**//**//**//**//**//**//**/
/**/// Get the modal
/**/var modal = document.getElementById("myModal1");
/**/
/**/// Get the button that opens the modal
/**/var btn = document.getElementById("myBtn");
/**/
/**/// Get the <span> element that closes the modal
/**/var span = document.getElementsByClassName("close1")[0];
/**/
/**/// When the user clicks the button, open the modal 
/**/btn.onclick = function () {
/**/  modal.style.display = "block";
            /**/
        }
/**/
/**/// When the user clicks on <span> (x), close the modal
/**/span.onclick = function () {
/**/  modal.style.display = "none";
            /**/
        }
/**/
/**/// When the user clicks anywhere outside of the modal, close it
/**/window.onclick = function (event) {
/**/  if (event.target == modal) {
/**/    modal.style.display = "none";
                /**/
            }
            /**/
        }
        /**//**//**//**//**//**//**//**//**//**//**//**//**//**//**//**//**//**//**//**/


    }
    //functions empresa 
    function verificarloja(token) {
        var json = decode(token);
        var id = json.id_user;
        getnrlojas(id, token);


    }
    //functions empresa 
    function getnrlojas(id, token) {
        var ident = id;
        var tokenrl = token.replace("token=", "");


        $.ajax({
            url: 'http://' + urlattime + '/loja/verificar_lojas/id=' + ident,
            type: 'GET',
            cache: false,
            headers: { "token": tokenrl },



            success: function (data) {

                if (data.message != "sem lojas") {
                    document.getElementById("numerodeloja").innerHTML = data.message;
                    getlojas(ident, token, data.message);
                }

            }
            , error: function (jqXHR, textStatus, err) {

                console.log(err, textStatus)

            }

        })

    }
    //functions admin 
    function get_adminspendentes() {
        var token = document.cookie;
        var tokenrl = token.replace("token=", "");


        $.ajax({
            url: 'http://' + urlattime + '/user/pendentes',
            type: 'GET',
            cache: false,
            headers: { "token": tokenrl },


            success: function (data) {


                var nomes = data.nome;
                var ids = data.id;
                console.log(nomes);






                for (let i = 0; i < nomes.length; i++) {
                    console.log(nomes);
                    $('#DispNrLojas').css("visibility", "hidden");
                    $('#rowpedidospend').append(`
                    <a href="?produto=${i + 1}">
                       <div class="col s2">
                           <div class="card">
                                <div class="card-content">
                                     <p>Nome User :${nomes[i]}</p>
                                     <p id="iduser">Id User :${ids[i]}
                               </div>
                               <div class="card-action">
                                   <a id="aproveperson" onclick='aprove(${ids[i]})'>Aprovar</a>
                                   <a onclick='delete_aprove(${ids[i]})'>Eliminar</a>
                                   
                               </div>
                         </div>
                      </div>
                    <a>`)
                }












            }
            , error: function (jqXHR, textStatus, err) {

                console.log(err, textStatus);
                console.log(jqXHR.responseText);
            }
        })

    }

    //functions admin 
    function aprove(id) {
        var ident = id;
        var token = document.cookie;
        var tokenrl = token.replace("token=", "");
        let tokendecode = decode(tokenrl);
        if (tokendecode.tipo == "admin") {
            $.ajax({
                url: 'http://' + urlattime + '/user/acept_pending/id=' + ident,
                type: 'PUT',
                cache: false,
                headers: { "token": tokenrl },


                success: function (data) {
                    location.reload();


                }
                , error: function (jqXHR, textStatus, err) {

                    console.log(err, textStatus)
                }
            })



        }

    }
    //functions admin
    function delete_aprove(id) {
        window.alert("eee")
        var token = document.cookie;
        var tokenrl = token.replace("token=", "");
        let tokendecode = decode(tokenrl);
        if (tokendecode.tipo == "admin") {
            $.ajax({
                url: 'http://' + urlattime + '/user/delete_pending',
                type: 'DELETE',
                cache: false,
                data: { id: id },
                headers: { "token": tokenrl },


                success: function (data) {
                    location.reload();


                }
                , error: function (jqXHR, textStatus, err) {

                    console.log(err, textStatus)
                }
            })



        }

    }




    //functions empresa 
    function getlojas(id, token, nrlojas) {
        var ident = id;
        var nr = nrlojas
        let params = (new URL(document.location)).searchParams;
        let loja = params.get("loja");
        var tokenrl = token.replace("token=", "");


        $.ajax({
            url: 'http://' + urlattime + '/loja/listar_lojas/id=' + ident,
            type: 'GET',
            cache: false,
            headers: { "token": tokenrl },


            success: function (data) {

                if (data.message != "sem lojas") {
                    var lojas = "" + data.nome;
                    var lojasingular = lojas.split(',');
                    var tipos = "" + data.tipo;
                    var tiposingular = tipos.split(',');
                    var moradas = "" + data.morada;
                    var moradasingular = moradas.split(',');
                    var codigos_postal = "" + data.cp;
                    var cpsingular = codigos_postal.split(',');
                    //verify if header isnt null
                    if (loja != null && loja != "") {
                        console.log("nome" + lojasingular[loja]);
                        $('#namelojaprodutos').append(`<h1 style="font-size:70px;font-family: 'Ubuntu', sans-serif; color:#282828; font-weight: bold !important;">${lojasingular[loja - 1]}</h1>`)
                        chamarprodutos(id, token);
                    }
                    else {
                        for (let i = 0; i < nr; i++) {

                            $('#row').append(`<a style="color:white;font-style: normal;"href="?loja=${i + 1}">
                                
                                <div class="col s2 ">
                                <div class="card grey darken-4 center-align">
                                  <div class="card-content white-text">
                                      <span class="card-title" style="font-size:40px;font-family: 'Ubuntu', sans-serif;color:#f8f8f8; font-weight: bold !important;"><h3> ${lojasingular[i]}<h1></span>
                                    <hr style="width:100%;text-align:left;color:#f8f8f8">
                                 </div>
                                 <div style="position: relative; top: -25;">
                                 <h5 style="margin-top:-5px; font-size:25px;font-weight: bold; over display:grid;">Tipo de comida</h5>
                                 <p style="font-size: 15px;position: relative; top: -10;">${tiposingular[i]}</p> 
                                 </div>
                                 <div style="position: relative; top: -25;">
                                 <h5 style="margin-top:-5px; font-size:25px; font-weight: bold; over display:grid;">Morada</h5>  
                                 <p style="font-size: 15px;position: relative; top: -10;"> ${moradasingular[i]}</p> 
                                 </div>
                                 <div>
                                 <h5 style="margin-top:-20px; font-size:25px; font-weight: bold; over display:grid;">Codigo-Postal</h5> 
                                 <p style="font-size: 15px;position: relative; top: -10;"> ${cpsingular[i]}</p>
                                 </div>
                                 <div>
                                    <div class="iconslojas right-align" style="position:relative; right:30px">
                                        <span class="material-icons">
                                            create
                                        </span>
                                        <span class="material-icons" style="right: -15px; position:relative;">
                                            delete
                                        </span>
                                    </div>
                                </div>
                                </div>
                                </div>
                               <a>`)
                        }
                    }








                }

            }
            , error: function (jqXHR, textStatus, err) {

                console.log(err, textStatus)
            }
        })


    }

    //functions empresa -loja
    function chamarprodutos(id, token) {
        var ident = id;
        var tokenrl = token.replace("token=", "");
        var tokenfr = decode(tokenrl);
        var tipo = tokenfr.tipo;

        let params = (new URL(document.location)).searchParams;
        let loja = params.get("loja");


        $.ajax({
            url: 'http://' + urlattime + '/produtos/get-products/id=' + loja,
            type: 'GET',
            cache: false,
            headers: { "token": tokenrl },


            success: function (data) {

                if (tipo == "empresa") {
                    var nomes = data.nome;
                    var imagem = data.url;
                    var descri = data.descricao;
                    var preco = data.preco;
                    $('#DispNrLojas').css("visibility", "hidden");
                    for (let i = 0; i < nomes.length; i++) {
                        console.log(imagem[i]);
                        $('#rowprodutos').append(`
                    <a href="?produto=${i + 1}">
                    <div class="col s2">
                        <div class="cardproduto">
                            <div class="card">
                                <div class="card-image">
                                    <img style="height:100%";" src="http://`+ urlattime + `/${imagem[i]}">
                                    <span class="card-title">${nomes[i]}</span>
                                </div>
                                <div class="card-content left-align">
                                    <div class="descrição">
                                        <h5 style="margin-top:-10px; font-weight: bold; color:#282828; font-size:20px;">Descrição</h5> 
                                        <p style="margin-top: 0px; font-size: 20px; color:#737373;"> ${descri[i]}</p>
                                    </div>
                                    <br>
                                    <div class="preco" >
                                        <h5 style="margin-top:-10px; font-weight: bold; color:#282828; font-size:20px;">Preço</h5> 
                                        <p style=" margin-top: 0px; font-size: 20px; color:#737373;"> ${preco[i]}</p>
                                    </div>
                                    <div class="iconsproduto right-align" style="position:relative; bottom: -15px;">
                                        <span class="material-icons orange-text darken-1">
                                            create
                                        </span>
                                        <span class="material-icons red-text darken-1" style="right: -20px; position: relative;">
                                            delete
                                        </span>   
                                    </div>                                 
                                </div>
                            </div>
                        </div>
                    </div>`
                        )
                    }
                } else {
                    var nomes = data.nome;
                    var imagem = data.url;
                    var descri = data.descricao;
                    var preco = data.preco;
                    
                    for (let i = 0; i < nomes.length; i++) {
                        $('#rowprodutos_cliente').append(`
                    <a href="?produto=${i + 1}">
                    <div class="col s2">
                        <div class="cardproduto">
                            <div class="card">
                                <div class="card-image">
                                    <img style="height:100%";" src="http://`+ urlattime + `/${imagem[i]}">
                                    <span class="card-title">${nomes[i]}</span>
                                </div>
                                <div class="card-content left-align">
                                    <div class="descrição">
                                        <h5 style="margin-top:-10px; font-weight: bold; color:#282828; font-size:20px;">Descrição</h5> 
                                        <p style="margin-top: 0px; font-size: 20px; color:#737373;"> ${descri[i]}</p>
                                    </div>
                                    <br>
                                    <div class="preco" >
                                        <h5 style="margin-top:-10px; font-weight: bold; color:#282828; font-size:20px;">Preço</h5> 
                                        <p style=" margin-top: 0px; font-size: 20px; color:#737373;"> ${preco[i]}</p>
                                    </div>
                                    <div class="iconsproduto right-align" style="position:relative; bottom: -15px;">
                                        <span class="material-icons orange-text darken-1">
                                            create
                                        </span>
                                        <span class="material-icons red-text darken-1" style="right: -20px; position: relative;">
                                            delete
                                        </span>   
                                    </div>                                 
                                </div>
                            </div>
                        </div>
                    </div>`)

                    }


                }

            }
            , error: function (jqXHR, textStatus, err) {

                console.log(err, textStatus)
            }
        })



    }

    //LOGOUT/**//**//**//**//**//**//**//**//**//**//**//**//**//**/
    $('#logout').click(function () {
        document.cookie = "token=; expires=Thu, 01 Jan 1970 00:00:00 UTC";
    });
    var x = document.cookie;

    //functions decode token
    function decode(token) {
        var base64Url = x.split('.')[1];
        var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
        var jsonPayload = decodeURIComponent(atob(base64).split('').map(function (c) {
            return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
        }).join(''));
        let json = JSON.parse(jsonPayload);
        return json;
    }
    if (x == "") { window.location.href = "../edly/login.html"; }
    let json = decode(x);
    let tipo = json.tipo
    let nome = json.nome;
    console.log("tipo->" + tipo)
    CheckProfile(tipo);



    /*greeting /**//**//**//**//**//**//**//**//**//**//**//**/
    /**/document.getElementById("username").innerHTML = nome;
    /**//**//**//**//**//**//**//**//**//**//**//**//**//**//**/

    /**//**//**//**//**//**//**//**//**//**//**//**//**//**//**/
    function CheckProfile(tipo) {
        var token = document.cookie;
        switch (tipo) {
            case "condutor":

                document.getElementById("cliente").style.display = "none";
                document.getElementById("administrador").style.display = "none";
                document.getElementById("empresa").style.display = "none";
                document.getElementById("navcliente2").style.display = "none";
                document.getElementById("navadministrador2").style.display = "none";
                document.getElementById("navempresa2").style.display = "none";
                document.getElementById("navcliente").style.display = "none";
                document.getElementById("navadministrador").style.display = "none";
                document.getElementById("navempresa").style.display = "none";
                break;
            case "cliente":

                document.getElementById("condutor").style.display = "none";
                document.getElementById("administrador").style.display = "none";
                document.getElementById("empresa").style.display = "none";
                document.getElementById("navcondutor2").style.display = "none";
                document.getElementById("navadministrador2").style.display = "none";
                document.getElementById("navempresa2").style.display = "none";
                document.getElementById("navcondutor").style.display = "none";
                document.getElementById("navadministrador").style.display = "none";
                document.getElementById("navempresa").style.display = "none";
                getlojastopcliente();
                break;
            case "admin":

                document.getElementById("cliente").style.display = "none";
                document.getElementById("condutor").style.display = "none";
                document.getElementById("empresa").style.display = "none";
                document.getElementById("navcliente2").style.display = "none";
                document.getElementById("navcondutor2").style.display = "none";
                document.getElementById("navempresa2").style.display = "none";
                document.getElementById("navcliente").style.display = "none";
                document.getElementById("navcondutor").style.display = "none";
                document.getElementById("navempresa").style.display = "none";
                get_adminspendentes();
                break;
            case "empresa":

                document.getElementById("cliente").style.display = "none";
                document.getElementById("administrador").style.display = "none";
                document.getElementById("condutor").style.display = "none";
                document.getElementById("navcliente2").style.display = "none";
                document.getElementById("navadministrador2").style.display = "none";
                document.getElementById("navcondutor2").style.display = "none";
                document.getElementById("navcliente").style.display = "none";
                document.getElementById("navadministrador").style.display = "none";
                document.getElementById("navcondutor").style.display = "none";
                verificarloja(token);
                break;
        }

    }


    /*function to verify if cookie is set /**//**//**//**/
    setInterval(function () {
        var x = document.cookie;
        if (x == "") {
            console.log("sem cookie")
            window.location.href = "../edly/login.html";

        } else {


        }

    }, 1000);

    // client area

    function getlojastopcliente() {
        var token = document.cookie;
        var tokenrl = token.replace("token=", "");
        let tokendecode = decode(tokenrl);


        $.ajax({
            url: 'http://' + urlattime + '/cliente/stores/?getTop=yes',
            type: 'GET',
            cache: false,
            headers: { "token": tokenrl },



            success: function (data) {

                let params = (new URL(document.location)).searchParams;
                let idloja = params.get("loja");
                var nomes = data.nome;
                var id = data.id;
                if (idloja == "" || idloja == null) {


                    for (var counter = 0; counter < nomes.length; counter++) {

                        $('#encontrartoplojas').append(`<div class="col s12 m4"><a href="?loja=${id[counter]}">
      <div class="card">
        <div class="card-image">
          <img style="height:80%"id="${id[counter]}"< src="">
          <span  style="color:black"class="card-title">${nomes[counter]}</span>
        </div>
        </div></a>`)

                        getimage(id[counter]);

                    }
                }
                else {

                    chamarprodutos(idloja, tokenrl);

                }


            }
            , error: function (jqXHR, textStatus, err) {

                console.log(err, textStatus)

            }

        })


    }
    function getlojascliente() {
        var token = document.cookie;
        var tokenrl = token.replace("token=", "");
        let tokendecode = decode(tokenrl);


        $.ajax({
            url: 'http://' + urlattime + '/cliente/stores/?getTop=No',
            type: 'GET',
            cache: false,
            headers: { "token": tokenrl },



            success: function (data) {

                let params = (new URL(document.location)).searchParams;
                let idloja = params.get("loja");
                var nomes = data.nome;
                var id = data.id;
                if (idloja == "" || idloja == null) {


                    for (var counter = 0; counter < nomes.length; counter++) {

                        $('#encontrartoplojas').append(`<div class="col s12 m4"><a href="?loja=${id[counter]}">
      <div class="card">
        <div class="card-image">
          <img style="height:80%"id="${id[counter]}"< src="">
          <span  style="color:black"class="card-title">${nomes[counter]}</span>
        </div>
        </div></a>`)

                        getimage(id[counter]);

                    }
                }
                else {

                    chamarprodutos(idloja, tokenrl);

                }


            }
            , error: function (jqXHR, textStatus, err) {

                console.log(err, textStatus)

            }

        })


    }



    function getimage(id) {
        var token = document.cookie;
        var tokenrl = token.replace("token=", "");
        var url;

        $.ajax({
            url: 'http://' + urlattime + '/cliente/image/id=' + id,
            type: 'GET',
            cache: false,
            headers: { "token": tokenrl },


            success: function (data) {

                url = data.nome_ficheiro;

                test(url, id);



            }
            , error: function (jqXHR, textStatus, err) {

                console.log(err, textStatus, jqXHR.responseText)

            }

        })

        return url;

    }
    function test(url, id) {

        document.getElementById(id).src = 'http://' + urlattime + '/' + url
    }
</script>
<script> M.AutoInit();</script>

</html>